<!DOCTYPE html>
<html>
<head>
    <meta charset= "utf-8" />
    <title>schedule maker</title>
    <link rel="stylesheet" href="assets/fonts/stylesheet.css">
    <link rel="stylesheet" href="assets/css/style.css"></head>
</head>
<body>
    <div class="header-wrapper">
        <div class="name-wrapper">
        <h1>Danya Cheng</h1>
        </div>
    </div>
    <div class="navbar">
        <a href="index.html">daynaaa</a>
        <a href="about.html">about me</a>
        <a href="projects.html">projects</a>
    </div>
    <div class="content-wrapper">
        <header>
            <h1>schedule maker</h1>
        </header>
        <div class="input">
            <h2>User Input</h2>
            name:
            <input type="text" id="name"> <br>
            start at:
            <input type="text" id="startAt" placeholder = "(i.e. 8:30 am)">
            end at:
            <input type="text" id="endAt" placeholder = "(i.e. 4:00 pm)"> 
            interval (mins):
            <input type="text" id="intervals" placeholder = "(i.e. 15)"> <br>

            course name:
            <input type="text" id="courseName">
            start time:
            <input type="text" id="startTime" placeholder = "(i.e. 8:30 am)">
            end time:
            <input type="text" id="endTime" placeholder = "(i.e. 9:30 am)">
            days:
            <input type="text" id="days" placeholder = "(i.e. MTWRF)"> <br>
            <div class="error-wrapper" id="error-wrapper" style="display: none;">
                <p id="p01"></p>
            </div>

            <button id="submit" onclick = "catchErrors()">submit</button>
        </div>
        <div class="schedule">
            <h2>
                <span id="schedule"></span>
            </h2>
            <table id="timetable">
                <thead>
                    <tr>
                        <th style = "width: 70px;">time</th>
                        <th style = "width: 140px;">mon</th>
                        <th style = "width: 140px;">tue</th>
                        <th style = "width: 140px;">wed</th>
                        <th style = "width: 140px;">thu</th>
                        <th style = "width: 140px;">fri</th>

                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
    <script>
        var submitButton = document.getElementById('submit');
        var n, sa, ea, cn, st, et, d;
        var message = document.getElementById("p01");
        var errorWrapper = document.getElementById("error-wrapper");
        function removeTableBody(){
            document.getElementById('timetable').getElementsByTagName('tbody')[0].innerHTML = '';
        }   
        function createSchedule(event){
            event.preventDefault();
            removeTableBody();
            var scheduleDiv = document.getElementById(schedule);
            n = document.getElementById("name").value;
            sa = document.getElementById("startAt").value;
            ea = document.getElementById("endAt").value;
            i = parseInt(document.getElementById("intervals").value);
            cn = document.getElementById("courseName").value;
            st = document.getElementById("startTime").value;
            et = document.getElementById("endTime").value;
            d = document.getElementById("days").value;
            /*n = "";
            sa = "8:30 am";
            ea = "4:00 pm";
            i = 30;
            cn = "math";
            st = "8:40 am";
            et = "9:30 am";
            d = "MWF";*/


            schedule.innerHTML = n +"\'s schedule:";
            const table = document.getElementById("timetable").getElementsByTagName('tbody')[0];

            var startMinutes = convertToMinutes(sa);
            var endMinutes = convertToMinutes(ea);

            for(let a = startMinutes; a <= endMinutes; a += i){
            const table = document.getElementById("timetable").getElementsByTagName('tbody')[0];

                const newRow = table.insertRow(-1);
                const cell1 = newRow.insertCell(0);
                let time = convertToTime(a);
                cell1.innerHTML = time;
                for(let b = 1; b <= 5; b++){
                    newRow.insertCell(b);
                }
            }
            //console.log("hi");
            //console.log(d.length);
            //console.log("cn " + cn + " st " + st + " et " + et + " startMinutes " + startMinutes + " endMinutes " + endMinutes + " i " + i);
            var courseStartMinutes = convertToMinutes(st);
            var courseEndMinutes = convertToMinutes(et);
            for(let a = 0; a < d.length; a++){
                console.log(d.charAt(a));
                setCellToCourse(cn, courseStartMinutes, courseEndMinutes, d.charAt(a), startMinutes, endMinutes, i);
            }
        }
        submitButton.addEventListener('click',createSchedule);

        function convertToMinutes(timeStr) {
            var ampm = timeStr.slice(-2);
            var timePart = timeStr.slice(0, -3).split(":");
            var hours = parseInt(timePart[0]);
            var minutes = parseInt(timePart[1]);
            if (ampm.toLowerCase() === "pm" && hours !== 12) {
                hours += 12;
            } 
            else if (ampm.toLowerCase() === "am" && hours === 12) {
                hours = 0;
            }
            return hours * 60 + minutes;
        }
        function convertToTime(minutes) {
            var hours = Math.floor(minutes / 60);
            var mins = minutes % 60;
            var ampm = hours >= 12 ? "pm" : "am";
            hours = hours % 12;
            hours = hours ? hours : 12; //midnight
            return ("0" + hours).slice(-2) + ":" + ("0" + mins).slice(-2) + " " + ampm;
        } 
        function setCellToCourse(cn, st, et, d, s, e, i){
            //console.log("cn " + cn + " st " + st + " et " + et + " d " + d + " s " + s + " e " + e + " i " + i);
            var startRow = Math.floor((st - s) / i);
            //console.log("startRow =" + startRow);
            var endRow = Math.floor((et - s) / i);
            //console.log("endRow =" + endRow);
            var day = getDay(d);
            //console.log("day =" + day);
            const table = document.getElementById("timetable").getElementsByTagName('tbody')[0];
            for(let a = startRow; a <= endRow; a++){
                table.rows[a].cells[day].innerHTML = cn;
                console.log("course logged");
            }
        }
        function getDay(d){
            switch(d.toUpperCase()){
                case 'M': return 1;
                case 'T': return 2;
                case 'W': return 3;
                case 'R': return 4;
                case 'F': return 5;
                default: return -1;
            }
        }
        function catchErrors(){
            n = document.getElementById("name").value;
            sa = document.getElementById("startAt").value;
            ea = document.getElementById("endAt").value;
            i = parseInt(document.getElementById("intervals").value);
            cn = document.getElementById("courseName").value;
            st = document.getElementById("startTime").value;
            et = document.getElementById("endTime").value;
            d = document.getElementById("days").value;
            /*n = "a";
            sa = "8:30 am";
            ea = "4:00 pm";
            i = 30;
            cn = "math";
            st = "8:40 am";
            et = "9:30 am";
            d = "MWF";*/
            //var message = document.getElementById("p01");
            //var errorWrapper = document.getElementById("error-wrapper");
            message.innerHTML = "";
            errorWrapper.style.display = "none";

            try {
                if(n.trim() == ""){
                    throw "enter a name"; //trim gets rid of spaces
                } 
                if(!/^\d{1,2}:\d{2} [ap]m$/i.test(sa) 
                || !/^\d{1,2}:\d{2} [ap]m$/i.test(ea) 
                || !/^\d{1,2}:\d{2} [ap]m$/i.test(st) 
                || !/^\d{1,2}:\d{2} [ap]m$/i.test(et)){
                    throw "wrong time format";
                }
                if(isNaN(i)){
                    throw "wrong format for interval";
                }
                if(cn.trim() == ""){
                    throw "enter a course name"; //trim gets rid of spaces
                }
                if(!/^[mtwrf]+$/i.test(d)) {
                    throw "invalid days";
                }
                //check if course time doesnt go within the table
                //check if a day is repeated maybe? doesnt rly matter tho
            }
            catch(err) {
                message.innerHTML =  err;
                errorWrapper.style.display = "block";
            }
            
        }
    </script>
</body>
</html>